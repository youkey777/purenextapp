<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PureNext - 水分摂取管理</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="app" id="app">
        <div class="header">
            <div class="logo">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M12,2C13.09,2 14.14,2.41 14.95,3.15C16.68,4.71 19.5,8.58 19.5,12A7.5,7.5 0 0,1 12,19.5A7.5,7.5 0 0,1 4.5,12C4.5,8.58 7.32,4.71 9.05,3.15C9.86,2.41 10.91,2 12,2Z" />
                </svg>
                PureNext
            </div>
            <div class="header-center" id="headerCenter">今日はあと2000mlで100%！</div>
            <button class="family-badge" id="familyIndicator" data-family="1">👥 家族 1</button>
        </div>

        <div class="main-content">
            <!-- ===== HOME ===== -->
            <div class="screen active" id="homeScreen">
                <div class="home-container">
                    <div class="pace-notification" id="paceNotification">水分補給のペースが少しゆっくりかも 🚰</div>

                    <div class="main-section">
                        <!-- LEFT -->
                        <div class="side-controls left">
                            <button class="side-pour-button" id="sidePourButton">取水</button>
                            <button class="side-preset-btn" data-ml="10">10ml</button>
                            <button class="side-preset-btn" data-ml="50">50ml</button>
                        </div>

                        <!-- CENTER: Human Silhouette -->
                        <div class="human-section">
                            <div class="silhouette-container">
                                <svg class="human-silhouette" viewBox="0 0 100 220">
                                    <!-- Stylish minimal silhouette -->
                                    <defs>
                                        <mask id="humanMask">
                                            <rect width="100" height="220" fill="black" />
                                            <!-- Head -->
                                            <circle cx="50" cy="18" r="12" fill="white" />
                                            <!-- Neck -->
                                            <rect x="46" y="30" width="8" height="8" rx="2" fill="white" />
                                            <!-- Torso -->
                                            <path
                                                d="M34 38 Q38 35 50 35 Q62 35 66 38 L64 82 Q62 88 58 92 L42 92 Q38 88 36 82 Z"
                                                fill="white" />
                                            <!-- Left Arm -->
                                            <path d="M34 40 Q28 44 24 52 L22 70 Q23 74 26 72 L30 68 Q34 62 35 52 Z"
                                                fill="white" />
                                            <!-- Right Arm -->
                                            <path d="M66 40 Q72 44 76 52 L78 70 Q77 74 74 72 L70 68 Q66 62 65 52 Z"
                                                fill="white" />
                                            <!-- Hips -->
                                            <path d="M42 92 Q46 98 50 100 Q54 98 58 92 L56 112 L44 112 Z"
                                                fill="white" />
                                            <!-- Left Leg -->
                                            <path d="M44 112 L40 160 Q40 166 42 168 L46 168 Q48 166 47 160 L48 112 Z"
                                                fill="white" />
                                            <!-- Right Leg -->
                                            <path d="M52 112 L53 160 Q52 166 54 168 L58 168 Q60 166 60 160 L56 112 Z"
                                                fill="white" />
                                            <!-- Left Calf -->
                                            <path d="M42 168 L40 200 Q41 206 44 206 L47 206 Q49 204 48 200 L46 168 Z"
                                                fill="white" />
                                            <!-- Right Calf -->
                                            <path d="M54 168 L53 200 Q54 206 56 206 L59 206 Q61 204 60 200 L58 168 Z"
                                                fill="white" />
                                            <!-- Feet -->
                                            <ellipse cx="44" cy="210" rx="6" ry="3" fill="white" />
                                            <ellipse cx="57" cy="210" rx="6" ry="3" fill="white" />
                                        </mask>
                                        <linearGradient id="waterGradient" x1="0%" y1="100%" x2="0%" y2="0%">
                                            <stop offset="0%" stop-color="#0ea5e9" />
                                            <stop offset="50%" stop-color="#38bdf8" />
                                            <stop offset="100%" stop-color="#7dd3fc" />
                                        </linearGradient>
                                    </defs>

                                    <!-- Body outline -->
                                    <circle class="human-body" cx="50" cy="18" r="12" />
                                    <rect class="human-body" x="46" y="30" width="8" height="8" rx="2" />
                                    <path class="human-body"
                                        d="M34 38 Q38 35 50 35 Q62 35 66 38 L64 82 Q62 88 58 92 L42 92 Q38 88 36 82 Z" />
                                    <path class="human-body"
                                        d="M34 40 Q28 44 24 52 L22 70 Q23 74 26 72 L30 68 Q34 62 35 52 Z" />
                                    <path class="human-body"
                                        d="M66 40 Q72 44 76 52 L78 70 Q77 74 74 72 L70 68 Q66 62 65 52 Z" />
                                    <path class="human-body" d="M42 92 Q46 98 50 100 Q54 98 58 92 L56 112 L44 112 Z" />
                                    <path class="human-body"
                                        d="M44 112 L40 160 Q40 166 42 168 L46 168 Q48 166 47 160 L48 112 Z" />
                                    <path class="human-body"
                                        d="M52 112 L53 160 Q52 166 54 168 L58 168 Q60 166 60 160 L56 112 Z" />
                                    <path class="human-body"
                                        d="M42 168 L40 200 Q41 206 44 206 L47 206 Q49 204 48 200 L46 168 Z" />
                                    <path class="human-body"
                                        d="M54 168 L53 200 Q54 206 56 206 L59 206 Q61 204 60 200 L58 168 Z" />
                                    <ellipse class="human-body" cx="44" cy="210" rx="6" ry="3" />
                                    <ellipse class="human-body" cx="57" cy="210" rx="6" ry="3" />

                                    <!-- Water fill -->
                                    <rect id="waterFill" x="0" y="220" width="100" height="0" fill="url(#waterGradient)"
                                        mask="url(#humanMask)" style="transition:all .8s cubic-bezier(.4,0,.2,1)" />
                                </svg>
                            </div>

                            <div class="human-controls">
                                <div class="buffer-display" id="bufferDisplay">現在 0ml</div>
                            </div>
                        </div>

                        <!-- RIGHT -->
                        <div class="side-controls right">
                            <button class="side-preset-btn" data-ml="100">100ml</button>
                            <button class="side-preset-btn" data-ml="500">500ml</button>
                            <button class="side-preset-btn" id="sideCustomBtn">任意</button>
                        </div>
                    </div>

                    <!-- Stats Panel (compact 4-col) -->
                    <div class="stats-panel">
                        <div class="stat-item">
                            <span class="stat-value" id="todayTotal">0ml</span>
                            <span class="stat-label">本日の合計</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="goalDisplay">2000ml</span>
                            <span class="stat-label">目標</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="rateDisplay">0%</span>
                            <span class="stat-label">達成率</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="remainDisplay">2000ml</span>
                            <span class="stat-label">残り</span>
                        </div>
                    </div>

                    <!-- Today's intake log -->
                    <div class="today-chart-section">
                        <h3>💧 今日の飲水ログ <span class="total-badge" id="todayLogTotal">合計: 0ml</span></h3>
                        <div class="chart-container">
                            <canvas id="todayChart" class="chart-canvas"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===== RECORDS ===== -->
            <div class="screen" id="recordsScreen">
                <div class="records-header" style="justify-content:flex-end;">
                    <button class="share-btn" id="shareRecordsBtn">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M18,16.08C17.24,16.08 16.56,16.38 16.04,16.85L8.91,12.7C8.96,12.47 9,12.24 9,12C9,11.76 8.96,11.53 8.91,11.3L15.96,7.19C16.5,7.69 17.21,8 18,8A3,3 0 0,0 21,5A3,3 0 0,0 18,2A3,3 0 0,0 15,5C15,5.24 15.04,5.47 15.09,5.7L8.04,9.81C7.5,9.31 6.79,9 6,9A3,3 0 0,0 3,12A3,3 0 0,0 6,15C6.79,15 7.5,14.69 8.04,14.19L15.16,18.34C15.11,18.55 15.08,18.77 15.08,19C15.08,20.61 16.39,21.91 18,21.91C19.61,21.91 20.92,20.61 20.92,19A2.92,2.92 0 0,0 18,16.08Z" />
                        </svg>
                        共有
                    </button>
                </div>

                <!-- Water Records -->
                <div class="records-content">
                    <div class="milk-tab-header" style="padding:0 20px 10px;">
                        <h3>💧 水分摂取の記録</h3>
                        <p class="milk-description" style="margin-bottom:0;">グラフを横にスクロールして過去の記録を確認できます</p>
                    </div>

                    <div class="chart-container scrollable-chart-container"
                        style="margin: 0 20px 20px; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); padding-bottom: 8px;">
                        <canvas id="dailyChart" class="chart-canvas" style="min-width: 600px; height: 180px;"></canvas>
                    </div>
                </div>

                <!-- Milk Section -->
                <div class="milk-independent-section">
                    <div class="milk-tab-header">
                        <h3>🍼 赤ちゃん用粉ミルク記録</h3>
                        <p class="milk-description">グラフを横にスクロールして過去の記録を確認できます</p>
                    </div>

                    <div class="chart-container scrollable-chart-container"
                        style="margin: 0 20px 20px; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 2px solid rgba(249, 115, 22, 0.1); padding-bottom: 8px;">
                        <canvas id="milkDailyChart" class="chart-canvas"
                            style="min-width: 600px; height: 180px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- ===== DEALS (お得) ===== -->
            <div class="screen" id="dealsScreen">
                <div class="deals-container">
                    <h3 class="deals-title" style="margin-bottom:16px;color:var(--primary);">🎁 お得な情報</h3>
                    <div class="banners-grid" style="display:flex;flex-direction:column;gap:16px;">
                        <a href="#" class="banner-card"
                            style="display:block;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.08);background:#fff;text-decoration:none;">
                            <img src="banner_yasune.png" alt="yasuneモール" id="bannerYasune"
                                style="width:100%;height:auto;display:block;aspect-ratio:16/9;object-fit:cover;">
                        </a>
                        <a href="#" class="banner-card"
                            style="display:block;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.08);background:#fff;text-decoration:none;">
                            <div id="bannerSim" class="placeholder-img"
                                style="width:100%;aspect-ratio:16/9;background:linear-gradient(135deg, #fb7185, #f43f5e);display:flex;align-items:center;justify-content:center;color:#fff;font-size:24px;font-weight:bold;">
                                📱 格安SIM</div>
                        </a>
                        <a href="#" class="banner-card"
                            style="display:block;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.08);background:#fff;text-decoration:none;">
                            <div id="bannerWimax" class="placeholder-img"
                                style="width:100%;aspect-ratio:16/9;background:linear-gradient(135deg, #60a5fa, #3b82f6);display:flex;align-items:center;justify-content:center;color:#fff;font-size:24px;font-weight:bold;">
                                📶 WiMAX</div>
                        </a>
                        <a href="#" class="banner-card"
                            style="display:block;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.08);background:#fff;text-decoration:none;">
                            <div id="bannerCloudWifi" class="placeholder-img"
                                style="width:100%;aspect-ratio:16/9;background:linear-gradient(135deg, #34d399, #10b981);display:flex;align-items:center;justify-content:center;color:#fff;font-size:24px;font-weight:bold;">
                                ☁️ クラウドWi-Fi</div>
                        </a>
                    </div>
                </div>
            </div>

            <!-- ===== POWER SAVE ===== -->
            <div class="screen" id="powerSaveScreen">
                <div class="power-save-container">
                    <div class="current-status">
                        <div class="status-indicator">
                            <div class="status-light off" id="statusLight"></div>
                            <span class="status-text" id="statusText">節電モード: OFF</span>
                        </div>
                        <button class="power-toggle-btn" id="powerToggleBtn">
                            <span id="toggleText">節電モードをONにする</span>
                        </button>
                    </div>

                    <div class="timer-settings">
                        <h3>
                            タイマー設定
                            <button class="timer-toggle" id="timerToggle" aria-label="タイマーON/OFF"></button>
                        </h3>
                        <div class="timer-controls" id="timerControlsBody">
                            <div class="time-inputs">
                                <label>開始</label>
                                <input type="time" id="startTime" class="time-input" value="22:00">
                                <label>終了</label>
                                <input type="time" id="endTime" class="time-input" value="06:00">
                            </div>
                            <div class="weekday-selector">
                                <label>曜日指定</label>
                                <div class="weekday-buttons">
                                    <button class="weekday-btn active" data-day="0">日</button>
                                    <button class="weekday-btn active" data-day="1">月</button>
                                    <button class="weekday-btn active" data-day="2">火</button>
                                    <button class="weekday-btn active" data-day="3">水</button>
                                    <button class="weekday-btn active" data-day="4">木</button>
                                    <button class="weekday-btn active" data-day="5">金</button>
                                    <button class="weekday-btn active" data-day="6">土</button>
                                </div>
                            </div>
                            <div class="timer-actions">
                                <button class="btn btn-secondary" id="clearTimerBtn">クリア</button>
                                <button class="btn btn-primary" id="saveTimerBtn">保存</button>
                            </div>
                        </div>
                    </div>

                    <div class="power-save-info">
                        <h4>節電モードについて</h4>
                        <ul>
                            <li>温水温度を下げて電気代を節約</li>
                            <li>タイマーで自動オン/オフが可能</li>
                            <li>曜日指定で平日・休日を使い分け</li>
                            <li>手動でいつでも切り替え可能</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- ===== INFO (情報) ===== -->
            <div class="screen" id="infoScreen">
                <div class="info-container">
                    <!-- Goal Section -->
                    <div class="info-card-section profile-section" style="margin-bottom:16px;">
                        <h3>🎯 水分目標</h3>
                        <div class="gw-card"
                            style="background:#fff;padding:16px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.04);text-align:center;">
                            <div class="goal-value" id="currentGoalValue"
                                style="font-size:28px;color:var(--primary);font-weight:bold;line-height:1;">2000</div>
                            <div class="goal-label" style="font-size:12px;color:var(--text-muted);margin-bottom:16px;">
                                ml / 日</div>
                            <input type="range" class="goal-slider" id="goalSlider" min="800" max="5000" step="50"
                                value="2000" style="width:100%;">
                        </div>
                    </div>

                    <!-- Weight Section -->
                    <div class="info-card-section profile-section" style="margin-bottom:20px;">
                        <h3>⚖️ 今日の体重</h3>
                        <div class="gw-card"
                            style="background:#fff;padding:16px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.04);display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                            <div class="weight-display" id="weightDisplayValue"
                                style="font-size:24px;color:var(--accent);font-weight:bold;">-- kg</div>
                            <button class="btn btn-accent" id="openWeightKeypad"
                                style="padding:10px 20px;font-size:14px;">記録する</button>
                        </div>
                        <div class="weight-chart"
                            style="background:#fff;padding:12px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.04);">
                            <canvas id="weightChartCanvas" style="width:100%;height:150px;"></canvas>
                        </div>
                    </div>

                    <!-- Profile Section -->
                    <div class="info-card-section profile-section" style="margin-bottom:20px;">
                        <h3>👤 登録情報
                            <button class="btn btn-secondary btn-sm" id="editProfileBtn"
                                style="float:right;font-size:11px;padding:4px 10px;">修正する</button>
                        </h3>
                        <div class="profile-preview info-cards"
                            style="padding:0;background:transparent;box-shadow:none;">
                            <div class="info-card" style="margin-bottom:4px;padding:8px 12px;"><span
                                    class="card-label">氏名</span><span class="card-value" id="previewName">未登録</span>
                            </div>
                            <div class="info-card" style="margin-bottom:4px;padding:8px 12px;"><span
                                    class="card-label">住所</span><span class="card-value" id="previewAddress">未登録</span>
                            </div>
                            <div class="info-card" style="margin-bottom:4px;padding:8px 12px;"><span
                                    class="card-label">生年月日</span><span class="card-value" id="previewBirth">未登録</span>
                            </div>
                            <div class="info-card" style="margin-bottom:4px;padding:8px 12px;"><span
                                    class="card-label">性別</span><span class="card-value" id="previewSex">未選択</span>
                            </div>
                        </div>
                    </div>

                    <!-- Filter Section -->
                    <div class="info-card-section profile-section" style="margin-bottom:20px;">
                        <h3>🔄 フィルター交換</h3>
                        <div class="filter-inputs"
                            style="background:#fff;padding:16px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.04);">
                            <div class="form-group" style="margin-bottom:12px;">
                                <label class="form-label">最終交換日</label>
                                <div style="display:flex;gap:8px;">
                                    <input type="date" class="form-input" id="lastReplacementDateInput">
                                    <button class="btn btn-secondary" id="setTodayFilterBtn"
                                        style="white-space:nowrap;padding:0 16px;">今日</button>
                                </div>
                            </div>
                            <div class="form-group" style="margin-bottom:12px;">
                                <label class="form-label">次回交換予定</label>
                                <input type="text" class="form-input" id="nextReplacementDateInput" value="2026年8月25日"
                                    readonly style="background:#f1f5f9;color:#64748b;pointer-events:none;">
                            </div>
                            <button class="btn btn-primary" id="filterPurchaseBtn"
                                style="width:100%;margin-top:8px;padding:16px;font-size:15px;font-weight:bold;">
                                <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor"
                                    style="width:18px;height:18px;margin-right:8px;vertical-align:middle;display:inline-block;">
                                    <path
                                        d="M19,7H15V6A3,3 0 0,0 12,3A3,3 0 0,0 9,6V7H5A1,1 0 0,0 4,8V19A3,3 0 0,0 7,22H17A3,3 0 0,0 20,19V8A1,1 0 0,0 19,7M11,6A1,1 0 0,1 12,5A1,1 0 0,1 13,6V7H11V6Z" />
                                </svg>
                                フィルターを購入する
                            </button>
                        </div>
                    </div>

                    <!-- Support and Group -->
                    <div class="info-card-section profile-section" style="margin-bottom:20px;">
                        <h3>⚙️ グループ設定</h3>
                        <div class="group-settings"
                            style="background:#fff;padding:16px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.04);">
                            <div class="form-group" style="margin-bottom:0;">
                                <label class="form-label" style="margin-bottom:0;">
                                    <input type="checkbox" id="enableGroupSharing" style="margin-right:6px;">
                                    記録をグループで共有する
                                </label>
                            </div>
                            <div class="form-group hidden" id="groupIdSection" style="margin-top:12px;">
                                <label class="form-label">グループID</label>
                                <div style="display:flex;gap:6px;">
                                    <input type="text" class="form-input" id="groupId" placeholder="グループIDを入力" readonly>
                                    <button class="btn btn-secondary" id="generateGroupIdBtn"
                                        style="padding:8px 14px;white-space:nowrap;">生成</button>
                                </div>
                                <div id="qrCodeArea"></div>
                            </div>
                            <div class="form-group hidden" id="joinGroupSection" style="margin-top:12px;">
                                <label class="form-label">他のグループに参加</label>
                                <div style="display:flex;gap:6px;">
                                    <input type="text" class="form-input" id="joinGroupId" placeholder="相手のグループIDを入力">
                                    <button class="btn btn-success" id="joinGroupBtn"
                                        style="padding:8px 14px;white-space:nowrap;">参加</button>
                                </div>
                            </div>
                            <div class="form-group hidden" id="groupMembersSection" style="margin-top:12px;">
                                <label class="form-label">グループメンバー</label>
                                <div class="group-members" id="groupMembersList">
                                    <p style="color:var(--text-muted);font-size:12px;">メンバーなし</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Independent Menu Section -->
                    <div class="info-card-section menu-section" style="margin-bottom:20px;">
                        <h3 style="margin-bottom:12px;">📄 ご利用明細</h3>
                        <button class="btn btn-secondary" id="viewStatementBtn"
                            style="display:block;text-align:center;width:100%;padding:16px;font-size:15px;font-weight:bold;background:#fff;border:1px solid var(--border);color:var(--text);margin-bottom:24px;">
                            <span style="font-size:18px;margin-right:8px;vertical-align:middle;">📋</span> 明細を見る
                        </button>

                        <h3 style="margin-bottom:12px;">🤝 友達に紹介</h3>
                        <button class="btn btn-success" id="contractInviteBtn"
                            style="width:100%;padding:16px;font-size:15px;font-weight:bold;margin-bottom:20px;">
                            <span style="font-size:18px;margin-right:8px;vertical-align:middle;">🎁</span>
                            友達を招待してお得な特典をゲット
                        </button>

                        <h3 style="margin-bottom:12px;">📞 サポート</h3>
                        <button class="btn btn-secondary" id="openContactModalBtn"
                            style="width:100%;padding:16px;font-size:15px;font-weight:bold;background:#fff;border:1px solid var(--border);color:var(--text);">
                            <span style="font-size:18px;margin-right:8px;vertical-align:middle;">❓</span> よくある質問・お問い合わせ
                        </button>
                    </div>
                </div>
            </div>

            <!-- ===== COLUMN (former Health) ===== -->
            <div class="screen" id="columnScreen">
                <!-- Column list view -->
                <div class="column-container" id="columnListView">
                    <h3>💧 水の健康コラム</h3>
                    <!-- Cards are generated by JS -->
                    <div id="columnCardsList"></div>

                    <div class="tips-section">
                        <h4>🎯 今日から始められる水分補給習慣</h4>
                        <div class="tips-grid">
                            <div class="tip-card"><span class="tip-icon">📱</span>
                                <p><strong>アプリで記録</strong><br>毎日の摂取量をトラッキング</p>
                            </div>
                            <div class="tip-card"><span class="tip-icon">💧</span>
                                <p><strong>ボトルを持参</strong><br>いつでも水分補給できる環境を</p>
                            </div>
                            <div class="tip-card"><span class="tip-icon">⏰</span>
                                <p><strong>時間を決める</strong><br>2時間ごとに水分補給タイムを</p>
                            </div>
                            <div class="tip-card"><span class="tip-icon">🌡️</span>
                                <p><strong>温度調節</strong><br>体温に近い温度が吸収されやすい</p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Column detail view (hidden initially) -->
                <div class="column-detail hidden" id="columnDetailView">
                    <button class="back-btn" id="columnBackBtn">← コラム一覧に戻る</button>
                    <h3 id="columnDetailTitle"></h3>
                    <div class="article-body" id="columnDetailBody"></div>
                    <div style="text-align:center; margin-top:20px; padding-bottom:20px;">
                        <button class="btn btn-secondary" id="columnBackBtnBottom" style="padding:12px 24px;">←
                            コラム一覧に戻る</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== FOOTER NAV ===== -->
        <div class="footer">
            <div class="tab-item active" data-screen="home">
                <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z" />
                </svg>
                <span class="tab-label">ホーム</span>
                <div class="tab-dot"></div>
            </div>
            <div class="tab-item" data-screen="records">
                <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M22,21H2V3H4V19H6V17H10V19H12V16H16V19H18V17H22V21Z" />
                </svg>
                <span class="tab-label">記録</span>
                <div class="tab-dot"></div>
            </div>
            <div class="tab-item" data-screen="powerSave">
                <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M16.56,5.44L15.11,6.89C16.84,7.94 18,9.83 18,12A6,6 0 0,1 12,18A6,6 0 0,1 6,12C6,9.83 7.16,7.94 8.88,6.88L7.44,5.44C5.36,6.88 4,9.28 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12C20,9.28 18.64,6.88 16.56,5.44M13,3H11V13H13" />
                </svg>
                <span class="tab-label">節電</span>
                <div class="tab-dot"></div>
            </div>
            <div class="tab-item" data-screen="info">
                <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,17A2,2 0 0,1 10,15A2,2 0 0,1 12,13A2,2 0 0,1 14,15A2,2 0 0,1 12,17M12,11A2,2 0 0,1 10,9A2,2 0 0,1 12,7A2,2 0 0,1 14,9A2,2 0 0,1 12,11Z" />
                </svg>
                <span class="tab-label">情報</span>
                <div class="tab-dot"></div>
            </div>
            <div class="tab-item" data-screen="deals">
                <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V15H11V17M11,13H13V7H11V13Z" />
                </svg>
                <span class="tab-label">お得</span>
                <div class="tab-dot"></div>
            </div>
            <div class="tab-item" data-screen="column">
                <svg class="tab-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3M7 7H17V9H7V7M7 11H17V13H7V11M7 15H14V17H7V15Z" />
                </svg>
                <span class="tab-label">コラム</span>
                <div class="tab-dot"></div>
            </div>
        </div>

        <!-- ===== MODALS ===== -->

        <!-- Profile Edit Modal -->
        <div class="modal hidden" id="profileEditModal">
            <div class="modal-content" style="max-height:90vh;overflow-y:auto;">
                <h3 style="margin-bottom:16px;">登録情報の修正</h3>
                <div class="form-group"><label class="form-label">氏名 <span class="req"
                            style="color:#ef4444;font-size:11px;">*必須</span></label><input type="text"
                        class="form-input" id="editProfileName"></div>
                <div class="form-group"><label class="form-label">住所 <span class="req"
                            style="color:#ef4444;font-size:11px;">*必須</span></label><input type="text"
                        class="form-input" id="editProfileAddress"></div>
                <div class="form-group"><label class="form-label">生年月日 <span class="req"
                            style="color:#ef4444;font-size:11px;">*必須</span></label><input type="date"
                        class="form-input" id="editProfileBirth"></div>
                <div class="form-group">
                    <label class="form-label">性別 <span class="req"
                            style="color:#ef4444;font-size:11px;">*必須</span></label>
                    <select class="form-select" id="editProfileSex">
                        <option value="未選択">未選択</option>
                        <option value="男性">男性</option>
                        <option value="女性">女性</option>
                        <option value="その他">その他</option>
                    </select>
                </div>
                <div class="form-group"><label class="form-label">身長 (cm) <span class="opt"
                            style="color:#94a3b8;font-size:11px;">*任意</span></label><input type="number"
                        class="form-input" id="editProfileHeight" min="0" max="300"></div>
                <!-- 体重と活動量も -->
                <div class="form-group"><label class="form-label">体重 (kg) <span class="opt"
                            style="color:#94a3b8;font-size:11px;">*任意</span></label><input type="number"
                        class="form-input" id="editProfileWeight" min="0" max="400"></div>
                <div class="form-group">
                    <label class="form-label">活動量 <span class="opt"
                            style="color:#94a3b8;font-size:11px;">*任意</span></label>
                    <select class="form-select" id="editProfileActivity">
                        <option value="低め">低め</option>
                        <option value="ふつう" selected>ふつう</option>
                        <option value="高め">高め</option>
                    </select>
                </div>
                <div class="modal-buttons" style="display:flex;gap:12px;margin-top:20px;">
                    <button class="btn btn-secondary" id="closeProfileEditBtn" style="flex:1;">キャンセル</button>
                    <button class="btn btn-primary" id="saveProfileEditBtn" style="flex:1;">保存する</button>
                </div>
            </div>
        </div>

        <!-- Contact Options Modal -->
        <div class="modal hidden" id="contactOptionsModal">
            <div class="modal-content">
                <h3 style="margin-bottom:16px;">お問い合わせ</h3>
                <p style="color:var(--text-muted);font-size:13px;margin-bottom:20px;">お問い合わせの前に、よくある質問（FAQ）をご確認ください。</p>
                <div style="display:flex;flex-direction:column;gap:12px;">
                    <button class="btn btn-primary" id="openFaqBtn" style="padding:14px;font-size:16px;">FAQを見る</button>
                    <button class="btn btn-secondary" id="openInquiryBtn"
                        style="padding:14px;font-size:16px;">直接お問い合わせする</button>
                </div>
                <div class="modal-buttons" style="margin-top:20px;">
                    <button class="btn" id="closeContactModalBtn"
                        style="width:100%;color:var(--text-muted);background:#f1f5f9;">閉じる</button>
                </div>
            </div>
        </div>

        <!-- Server Connection Modal -->
        <div class="modal hidden" id="serverConnectionModal">
            <div class="modal-content">
                <h3 style="margin-bottom:16px;text-align:center;">ウォーターサーバー接続</h3>

                <!-- 接続中状態 -->
                <div id="serverConnectedState">
                    <p style="text-align:center;color:var(--success);font-weight:bold;margin-bottom:12px;">現在接続中</p>
                    <p style="text-align:center;color:var(--text-muted);font-size:13px;margin-bottom:24px;">接続先: <span
                            id="currentConnectionName">家族 1</span></p>
                    <button class="btn btn-danger" id="disconnectServerBtn"
                        style="width:100%;padding:14px;font-size:15px;margin-bottom:12px;">接続を解除する</button>
                </div>

                <!-- 未接続状態 -->
                <div id="serverDisconnectedState" class="hidden">
                    <p style="text-align:center;color:var(--text-muted);font-size:13px;margin-bottom:20px;">
                        サーバー番号を選択して接続してください。</p>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:24px;">
                        <button class="btn btn-secondary connect-server-btn" data-server="1" style="padding:16px;">家族
                            1</button>
                        <button class="btn btn-secondary connect-server-btn" data-server="2" style="padding:16px;">家族
                            2</button>
                        <button class="btn btn-secondary connect-server-btn" data-server="3" style="padding:16px;">家族
                            3</button>
                        <button class="btn btn-secondary connect-server-btn" data-server="4" style="padding:16px;">家族
                            4</button>
                    </div>
                </div>

                <div class="modal-buttons">
                    <button class="btn" id="closeServerConnectionModalBtn"
                        style="width:100%;color:var(--text-muted);background:#f1f5f9;margin-top:12px;">閉じる</button>
                </div>
            </div>
        </div>

        <!-- Detail Layout Modal (詳細内訳モーダル) -->
        <div class="modal hidden" id="detailHistoryModal">
            <div class="modal-content" style="max-height:85vh;overflow-y:auto;padding:0;background:#f8fafc;">
                <div
                    style="position:sticky;top:0;background:var(--surface);z-index:10;padding:16px 20px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 4px rgba(0,0,0,0.02);">
                    <h3 style="margin:0;font-size:16px;color:var(--text);" id="detailModalTitle">日付の記録</h3>
                    <button id="closeDetailModalBtn"
                        style="background:none;border:none;font-size:24px;line-height:1;color:var(--text-muted);cursor:pointer;padding:0 8px;">&times;</button>
                </div>
                <div style="padding:20px;">
                    <div class="chart-container"
                        style="margin-bottom:20px;background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.04);border:none;padding:16px;"
                        id="modalDetailChartContainer">
                        <canvas id="modalDetailChart" class="chart-canvas" style="height:140px;"></canvas>
                    </div>
                    <div class="history-content" id="modalHistoryContent"
                        style="background:transparent;padding:0;border:none;box-shadow:none;">
                        <!-- ここにリスト表示が入る -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== Onboarding Modal ===== -->
        <div class="modal hidden" id="onboardingModal">
            <div class="modal-content">
                <h2 class="modal-title">PureNextへようこそ</h2>
                <div class="form-group"><label class="form-label">氏名 <span class="req"
                            style="color:#ef4444;font-size:11px;">*必須</span></label><input type="text"
                        class="form-input" id="onboardingName" required></div>
                <div class="form-group"><label class="form-label">住所 <span class="req"
                            style="color:#ef4444;font-size:11px;">*必須</span></label><input type="text"
                        class="form-input" id="onboardingAddress" required></div>
                <div class="form-group"><label class="form-label">生年月日 <span class="req"
                            style="color:#ef4444;font-size:11px;">*必須</span></label><input type="date"
                        class="form-input" id="onboardingBirth" required></div>
                <div class="form-group">
                    <label class="form-label">性別 <span class="req"
                            style="color:#ef4444;font-size:11px;">*必須</span></label>
                    <select class="form-select" id="onboardingSex" required>
                        <option value="未選択">未選択</option>
                        <option value="男性">男性</option>
                        <option value="女性">女性</option>
                        <option value="その他">その他</option>
                    </select>
                </div>
                <div class="form-group"><label class="form-label">身長 (cm) <span class="opt"
                            style="color:#94a3b8;font-size:11px;">*任意</span></label><input type="number"
                        class="form-input" id="onboardingHeight" min="0" max="300"></div>
                <div class="form-group"><label class="form-label">体重 (kg) <span class="opt"
                            style="color:#94a3b8;font-size:11px;">*任意</span></label><input type="number"
                        class="form-input" id="onboardingWeight" min="0" max="400"></div>
                <div class="form-group">
                    <label class="form-label">活動量 <span class="opt"
                            style="color:#94a3b8;font-size:11px;">*任意</span></label>
                    <select class="form-select" id="onboardingActivity">
                        <option value="低め">低め</option>
                        <option value="ふつう" selected>ふつう</option>
                        <option value="高め">高め</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-primary" id="saveOnboardingBtn">保存</button>
                    <button class="btn btn-secondary" id="skipOnboardingBtn">スキップ</button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>